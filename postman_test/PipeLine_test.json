{
	"info": {
		"_postman_id": "68f3ff17-f31b-488b-b85f-de1bed18eae2",
		"name": "PipeLine",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "50149898",
		"_collection_link": "https://prathmeshsargar10-6670365.postman.co/workspace/Prathmesh-Sargar's-Workspace~6f2f6a34-1a87-47f7-81f8-1867aab1e085/collection/50149898-68f3ff17-f31b-488b-b85f-de1bed18eae2?action=share&source=collection_link&creator=50149898"
	},
	"item": [
		{
			"name": "Status",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Post-response tests for GET http://localhost:8043/status",
							"// Validates status code, response time, headers, JSON schema, and content.",
							"// Extracts id and timestamp to environment (fallback to collection) and performs additional guards.",
							"",
							"(function () {",
							"    const hasActiveEnv = !!pm.environment.name; // active env present per context; fallback to collection if not",
							"",
							"    function setScopedVar(key, value) {",
							"        if (hasActiveEnv) {",
							"            pm.environment.set(key, value);",
							"        } else {",
							"            pm.collectionVariables.set(key, value);",
							"        }",
							"    }",
							"",
							"    function unsetScopedVar(key) {",
							"        if (hasActiveEnv) {",
							"            pm.environment.unset(key);",
							"        } else {",
							"            pm.collectionVariables.unset(key);",
							"        }",
							"    }",
							"",
							"    pm.test(\"Status code is 200\", function () {",
							"        pm.response.to.have.status(200);",
							"    });",
							"",
							"    pm.test(\"Response time is under 800 ms\", function () {",
							"        pm.expect(pm.response.responseTime).to.be.below(800);",
							"    });",
							"",
							"    pm.test(\"Content-Type header is application/json\", function () {",
							"        pm.response.to.have.header(\"Content-Type\");",
							"        const ct = pm.response.headers.get(\"Content-Type\") || \"\";",
							"        pm.expect(ct.toLowerCase()).to.include(\"application/json\");",
							"    });",
							"",
							"    pm.test(\"Response body is valid JSON\", function () {",
							"        let parsed;",
							"        pm.expect(function () {",
							"            parsed = pm.response.json();",
							"        }).to.not.throw();",
							"        pm.expect(parsed).to.be.an(\"object\");",
							"    });",
							"",
							"    // JSON schema validation (order-independent)",
							"    pm.test(\"Response matches expected schema\", function () {",
							"        const schema = {",
							"            type: \"object\",",
							"            properties: {",
							"                id: { type: \"string\", minLength: 1 },",
							"                message: { type: \"string\", minLength: 1 },",
							"                timestamp: { type: \"string\", pattern: \"^\\\\d+$\" }",
							"            },",
							"            required: [\"id\", \"message\", \"timestamp\"],",
							"            additionalProperties: false",
							"        };",
							"",
							"        const ajv = new Ajv({ allErrors: true, strict: false });",
							"        const validate = ajv.compile(schema);",
							"        const data = pm.response.json();",
							"        const valid = validate(data);",
							"        if (!valid) {",
							"            console.log(\"Schema errors:\", validate.errors);",
							"        }",
							"        pm.expect(valid, \"Schema validation errors: \" + JSON.stringify(validate.errors)).to.be.true;",
							"    });",
							"",
							"    pm.test(\"Message is a non-empty string and mentions 'running' (case-insensitive)\", function () {",
							"        const { message } = pm.response.json();",
							"        pm.expect(message).to.be.a(\"string\");",
							"        pm.expect(message.trim().length).to.be.greaterThan(0);",
							"        pm.expect(/running/i.test(message)).to.be.true;",
							"    });",
							"",
							"    pm.test(\"Timestamp is a numeric string representing a recent time (<= 5 minutes)\", function () {",
							"        const { timestamp } = pm.response.json();",
							"        pm.expect(timestamp).to.be.a(\"string\");",
							"        pm.expect(/^\\d+$/.test(timestamp), \"timestamp must be numeric string\").to.be.true;",
							"        const tsNum = Number(timestamp);",
							"        pm.expect(Number.isFinite(tsNum)).to.be.true;",
							"        // Accept seconds or milliseconds; normalize to ms",
							"        const now = Date.now();",
							"        const tsMs = tsNum < 1e12 ? tsNum * 1000 : tsNum; // if seconds, convert to ms",
							"        pm.expect(tsMs).to.be.at.most(now);",
							"        const diff = Math.abs(now - tsMs);",
							"        pm.expect(diff).to.be.below(5 * 60 * 1000);",
							"    });",
							"",
							"    pm.test(\"ID is a non-empty string (UUID allowed but not enforced)\", function () {",
							"        const { id } = pm.response.json();",
							"        pm.expect(id).to.be.a(\"string\");",
							"        pm.expect(id.trim().length).to.be.greaterThan(0);",
							"    });",
							"",
							"    pm.test(\"No unexpected properties are present\", function () {",
							"        const data = pm.response.json();",
							"        const allowed = [\"id\", \"message\", \"timestamp\"];",
							"        const keys = Object.keys(data);",
							"        const unexpected = keys.filter(k => !allowed.includes(k));",
							"        pm.expect(unexpected, \"Unexpected keys found: \" + unexpected.join(\", \")).to.have.length(0);",
							"    });",
							"",
							"    // Extraction",
							"    pm.test(\"Extract id and timestamp to scoped variables\", function () {",
							"        const data = pm.response.json();",
							"        setScopedVar(\"status_id\", data.id);",
							"        setScopedVar(\"status_timestamp\", data.timestamp);",
							"        // Also store human-readable ISO from timestamp for convenience",
							"        let tsNum = Number(data.timestamp);",
							"        const tsMs = tsNum < 1e12 ? tsNum * 1000 : tsNum;",
							"        setScopedVar(\"status_timestamp_iso\", new Date(tsMs).toISOString());",
							"    });",
							"",
							"})();"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "http://localhost:8043/status",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8043",
					"path": [
						"status"
					]
				}
			},
			"response": []
		}
	]
}